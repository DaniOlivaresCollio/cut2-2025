"0","# 1) Totales ponderados por clase x sexo y proporciones dentro de cada clase"
"0","tabla_stack <- data_svy %>%"
"0","  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%"
"0","  group_by(wrightclass1_reduced, sexo) %>%"
"0","  summarise(n = survey_total(vartype = NULL)) %>%   # totales ponderados"
"0","  group_by(wrightclass1_reduced) %>%"
"0","  mutate(prop = n / sum(n)) %>%                     # % dentro de cada clase"
"0","  ungroup()"
"0",""
"0","# 2) Gráfico apilado (cada barra suma 100%)"
"0","ggplot(tabla_stack, aes(x = wrightclass1_reduced, y = prop, fill = sexo)) +"
"0","  geom_col(position = ""stack"") +"
"0","  scale_fill_manual(values = c(""Mujer"" = ""#f25f5c"", ""Hombre"" = ""#9e1b1e"")) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  geom_text("
"0","    aes(label = paste0(round(prop * 100, 1), ""%"")),"
"0","    position = position_stack(vjust = 0.5),"
"0","    color = ""white"","
"0","    size = 2.8"
"0","  ) +"
"0","  labs("
"0","    title = ""Composición por sexo dentro de cada clase social"","
"0","    caption = ""Nota: Datos ponderados."","
"0","    x = ""Clase social"","
"0","    y = ""Porcentaje dentro de la clase"","
"0","    fill = ""Sexo"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x = element_text(angle = 45, hjust = 1))"
