"0","# Calcular totales ponderados por clase x sexo"
"0","tabla_sex_norm <- data_svy %>%"
"0","  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%"
"0","  group_by(wrightclass1_reduced, sexo) %>%"
"0","  summarise(n = survey_total(vartype = NULL)) %>%"
"0","  ungroup() %>%"
"0","  # (opcional) asegurar combinaciones faltantes con 0"
"0","  complete(wrightclass1_reduced, sexo, fill = list(n = 0)) %>%"
"0","  group_by(sexo) %>%"
"0","  mutate(prop = n / sum(n)) %>%      # proporción dentro de cada sexo"
"0","  ungroup()"
"0",""
"0","# Gráfico: barras agrupadas (dodge), normalizadas dentro de cada sexo"
"0","ggplot(tabla_sex_norm, aes(x = wrightclass1_reduced, y = prop, fill = sexo)) +"
"0","  geom_col(position = position_dodge(width = 0.8)) +"
"0","  scale_fill_manual(values = c(""Mujer"" = ""#f25f5c"", ""Hombre"" = ""#9e1b1e"")) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  geom_text("
"0","    aes(label = paste0(round(prop * 100, 1), ""%"")),"
"0","    position = position_dodge(width = 0.8),"
"0","    vjust = -0.3,"
"0","    size = 2.8"
"0","  ) +"
"0","  labs("
"0","    title = ""Distribución por clase social dentro de cada sexo"","
"0","    x = ""Clase social"","
"0","    y = ""Porcentaje"","
"0","    fill = ""Sexo"","
"0","    caption = ""Nota: Datos ponderados."""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x = element_text(angle = 45, hjust = 1))"
