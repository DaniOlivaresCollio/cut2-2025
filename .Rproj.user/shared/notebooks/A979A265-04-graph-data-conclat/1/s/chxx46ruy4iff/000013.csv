"0","# Calcular proporciones por sexo y edad"
"0","class1_sexo_edad <- data_svy %>%"
"0","  filter("
"0","    !is.na(sexo),"
"0","    !is.na(edad_tramos),"
"0","    !is.na(wrightclass1_reduced)"
"0","  ) %>%"
"0","  group_by(edad_tramos, sexo, wrightclass1_reduced) %>%"
"0","  summarise(prop = survey_mean(na.rm = TRUE)) %>%"
"0","  ungroup()"
"0",""
"0","# Graficar"
"0","grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +"
"0","  geom_col(position = ""fill"", color = ""white"") +"
"0","  geom_text("
"0","    aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), ""%""), """")),  # mostrar solo si es >4%"
"0","    position = position_fill(vjust = 0.5),"
"0","    color = ""white"","
"0","    size = 3.5"
"0","  ) +"
"0","  facet_wrap(~sexo) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  scale_fill_manual("
"0","    values = c("
"0","      ""1. Formal workers"" = ""#6f0000"","
"0","      ""2. Informal workers"" = ""#9e1b1e"","
"0","      ""3. Informal self-employed"" = ""#ca0000"","
"0","      ""4. Experts"" = ""#ff5651"","
"0","      ""5. Supervisors"" =""#b23a48"","
"0","      ""6. Managers"" = ""#8c1d40"","
"0","      ""7. Petty bourgeoisie"" = ""#d1eaf3"","
"0","      ""8. Small employers"" = ""#0f6481"","
"0","      ""9. Employers"" = ""#083342"""
"0","  )) +"
"0","  labs("
"0","    title = ""Clases"","
"0","    subtitle = ""Porcentajes seg√∫n sexo y tramo etario"","
"0","    x = ""Tramo de edad"","
"0","    y = ""Porcentaje"","
"0","    fill = ""Clases"","
"0","    caption = ""Nota: Datos ponderados. N = 3048."""
"0","  ) +"
"0","  theme_minimal()"
"0",""
"0","grafico"
