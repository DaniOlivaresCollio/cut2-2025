"0","# Calcular proporciones por sexo y edad"
"0","pol_id_sexo_edad <- data_svy %>%"
"0","  filter("
"0","    !is.na(sexo),"
"0","    !is.na(edad_tramos),"
"0","    !is.na(pol_id)"
"0","  ) %>%"
"0","  group_by(edad_tramos, sexo, pol_id) %>%"
"0","  summarise(prop = survey_mean(na.rm = TRUE)) %>%"
"0","  ungroup()"
"0",""
"0","# Graficar"
"0","grafico <- ggplot(pol_id_sexo_edad, aes(x = edad_tramos, y = prop, fill = pol_id)) +"
"0","  geom_col(position = ""fill"", color = ""white"") +"
"0","  geom_text("
"0","    aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), ""%""), """")),  # mostrar solo si es >4%"
"0","    position = position_fill(vjust = 0.5),"
"0","    color = ""white"","
"0","    size = 3.5"
"0","  ) +"
"0","  facet_wrap(~sexo) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  scale_fill_manual("
"0","    values = c("
"0","      ""Izquierda"" = ""#6f0000"","
"0","      ""Centro"" = ""#9e1b1e"","
"0","      ""Derecha"" = ""#ca0000"","
"0","      ""No se identifica"" = ""#ff5651"""
"0","  )) +"
"0","  labs("
"0","    title = ""Identificación política"","
"0","    subtitle = ""Porcentajes según sexo y tramo etario"","
"0","    x = ""Tramo de edad"","
"0","    y = ""Porcentaje"","
"0","    fill = ""Identificación política"","
"0","    caption = ""Nota: Datos ponderados. N = 3048."""
"0","  ) +"
"0","  theme_minimal()"
"0",""
"0","grafico"
