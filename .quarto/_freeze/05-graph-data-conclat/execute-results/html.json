{
  "hash": "9864b38748850b70d085e348ee6bffbf",
  "result": {
    "engine": "knitr",
    "markdown": "# Gráficos 4: Final\n\n## Preparación\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n### Cargar datos\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"output/data/datos-cut.Rdata\")\n\n# base survey\ndata_svy <- as_survey_design(data, weights = rake_wb2)\n```\n:::\n\n\n\n\n\n\n### Función acuerdo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by <- function(\n  data,                # poner la data svy\n  var,                 # variable binaria 0/1\n  x_var,               # categórica para eje X\n  fill_var,            # categórica para fill\n  title,               # título del gráfico\n  subtitle,            # subtítulo del gráfico\n\n  # ---- Etiquetas ----\n  x_label = NULL,\n  y_label = \"Porcentaje\",\n  fill_label = NULL,\n  caption = NULL,\n\n  # ---- Porcentajes ----\n  label_accuracy = 0.1,\n  axis_accuracy  = 1,\n\n  # ---- Estilo y escala ----\n  expand_y = TRUE,\n  palette = NULL,\n  dodge_width = 0.8,\n\n  # ---- Texto eje X (nuevo) ----\n  x_text_angle = 0,           # 0, 45, 90 típicamente\n  x_text_hjust = NULL,        # si NULL, se decide según ángulo\n  x_text_vjust = NULL,        # si NULL, se decide según ángulo\n  x_text_size  = 8,          # tamaño de fuente\n\n  # ---- Guardado ----\n  file   = NULL,\n  width  = 10,\n  height = 6,\n  dpi    = 300,\n\n  # ---- Comportamiento ----\n  show = TRUE,\n  save = TRUE,\n  return_df = FALSE,\n  ...\n) {\n  var_name   <- as_name(ensym(var))\n  x_name     <- as_name(ensym(x_var))\n  fill_name  <- as_name(ensym(fill_var))\n  x_label    <- x_label    %||% as_label(enquo(x_var))\n  fill_label <- fill_label %||% as_label(enquo(fill_var))\n\n  df <- data %>%\n    filter(\n      !is.na({{ x_var }}),\n      !is.na({{ fill_var }}),\n      !is.na({{ var }})\n    ) %>%\n    group_by({{ x_var }}, {{ fill_var }}) %>%\n    summarise(prop = survey_mean({{ var }}, na.rm = TRUE),\n              .groups = \"drop\")\n\n  N_unw <- data %>%\n    filter(\n      !is.na({{ x_var }}),\n      !is.na({{ fill_var }}),\n      !is.na({{ var }})\n    ) %>%\n    summarise(n = n()) %>% pull(n)\n\n  if (is.null(caption)) {\n    caption <- paste0(\n      \"Nota: Datos ponderados. Proporción que responde De acuerdo (4) o Muy de acuerdo (5). N = \",\n      format(N_unw, big.mark = \".\", decimal.mark = \",\")\n    )\n  }\n\n  y_scale <- if (isTRUE(expand_y)) {\n    scale_y_continuous(labels = percent_format(accuracy = axis_accuracy),\n                       expand = expansion(mult = c(0, 0.1)))\n  } else {\n    scale_y_continuous(labels = percent_format(accuracy = axis_accuracy))\n  }\n\n  # Defaults razonables para hjust/vjust según ángulo\n  .hjust <- if (is.null(x_text_hjust)) {\n    if (x_text_angle == 0) 0.5 else 1\n  } else x_text_hjust\n\n  .vjust <- if (is.null(x_text_vjust)) {\n    if (x_text_angle == 90) 0.5 else 1\n  } else x_text_vjust\n\n  p <- ggplot(df, aes(x = {{ x_var }}, y = prop, fill = {{ fill_var }})) +\n    geom_col(position = position_dodge(width = dodge_width)) +\n    geom_text(\n      aes(label = percent(prop, accuracy = label_accuracy)),\n      position = position_dodge(width = dodge_width),\n      vjust = 1.3,\n      size = 2.5,\n      color = \"white\"\n    ) +\n    (if (is.null(palette)) scale_fill_discrete() else scale_fill_manual(values = palette)) +\n    y_scale +\n    labs(\n      title = title,\n      subtitle = subtitle,\n      caption = caption,\n      x = x_label,\n      y = y_label,\n      fill = fill_label\n    ) +\n    theme_minimal() +\n    theme(\n      axis.text.x = element_text(angle = x_text_angle, hjust = .hjust, vjust = .vjust, size = x_text_size)\n    )\n\n  if (isTRUE(show)) print(p)\n\n  if (isTRUE(save)) {\n    if (is.null(file)) {\n      if (!dir.exists(\"output/graph4\")) dir.create(\"output/graph4\", recursive = TRUE)\n      file <- file.path(\"output/graph4\", paste0(var_name, \"_by_\", x_name, \"_and_\", fill_name, \".png\"))\n    } else {\n      dir_to_make <- dirname(file)\n      if (!dir.exists(dir_to_make)) dir.create(dir_to_make, recursive = TRUE)\n    }\n    ggsave(filename = file, plot = p, width = width, height = height, dpi = dpi, ...)\n  }\n\n  if (isTRUE(return_df)) {\n    return(invisible(list(plot = p, data = df)))\n  } else {\n    return(invisible(p))\n  }\n}\n```\n:::\n\n\n\n\n\n\n## Edad y sexo\n\n### edad\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular proporciones ponderadas solo por clase social\ntabla_total <- data_svy %>%\n  filter(!is.na(edad_tramos)) %>% \n  group_by(edad_tramos) %>%\n  summarise(prop = survey_mean(vartype = NULL, proportion = TRUE)) %>%\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(edad_tramos)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico\nggplot(tabla_total, aes(x = edad_tramos, y = prop)) +\n  geom_col(fill = \"#9e1b1e\") +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    vjust = -0.3,\n    color = \"black\",\n    size = 3\n  ) +\n  labs(\n    title = \"Distribución de la población por edad\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw),\n    x = \"Tramo de edad\",\n    y = \"Porcentaje\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 0, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/edad.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular totales ponderados por clase x sexo\ntabla_total <- data_svy %>%\n  filter(!is.na(edad_tramos), !is.na(sexo)) %>%\n  group_by(edad_tramos, sexo) %>%\n  summarise(n = survey_total(vartype = NULL)) %>%\n  ungroup() %>%\n  # (opcional) asegurar combinaciones faltantes con 0\n  complete(edad_tramos, sexo, fill = list(n = 0)) %>%\n  group_by(sexo) %>%\n  mutate(prop = n / sum(n)) %>%      # proporción dentro de cada sexo\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(edad_tramos), !is.na(sexo)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico: barras agrupadas (dodge), normalizadas dentro de cada sexo\nggplot(tabla_total, aes(x = edad_tramos, y = prop, fill = sexo)) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  scale_fill_manual(values = c(\"Mujer\" = \"#f25f5c\", \"Hombre\" = \"#9e1b1e\")) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    position = position_dodge(width = 0.8),\n    vjust = -0.3,\n    size = 2.8\n  ) +\n  labs(\n    title = \"Distribución por tramo etario dentro de cada sexo\",\n    x = \"Tramos de edad\",\n    y = \"Porcentaje\",\n    fill = \"Sexo\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw)\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/edad_sexo.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### c05_02 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_02_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Una de las principales razones de la alta desigualdad en Chile \\nes que los dueños de las empresas pagan poco a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c05_03 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_03_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: El alto nivel de vida de los dueños de las empresas es resultado \\nde lo poco que pagan a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c06_02 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c06_02_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Apoyaría una reforma para crear un sistema solidario de reparto \\nsi eso permite subir las pensiones\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_01 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_01_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Aumentar los impuestos a los más ricos para financiar \\nprogramas sociales\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_03 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_03_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Implementar leyes para que los sindicatos tengan más poder \\nde negociación\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_04 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_04_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Redistribuir las riquezas desde quienes tienen más recursos \\nhacia quienes tienen menos recursos\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_05 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_05_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Promover la igualdad entre hombres y mujeres\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_06 x edad x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_06_acuerdo,\n  x_var = edad_tramos,\n  fill_var = sexo,\n  title = \"Acuerdo con: Garantizar la educación universitaria pública y gratuita\",\n  subtitle = \"Porcentaje según sexo y edad\",\n  x_label = \"Tramo de edad\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Clase y sexo\n\n### clase 1 reduced\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular proporciones ponderadas solo por clase social\ntabla_total <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced)) %>% \n  group_by(wrightclass1_reduced) %>%\n  summarise(prop = survey_mean(vartype = NULL, proportion = TRUE)) %>%\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico\nggplot(tabla_total, aes(x = wrightclass1_reduced, y = prop)) +\n  geom_col(fill = \"#9e1b1e\") +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    vjust = -0.3,\n    color = \"black\",\n    size = 3\n  ) +\n  labs(\n    title = \"Distribución de la población por clase social\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw),\n    x = \"Clase social\",\n    y = \"Porcentaje\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/class1.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular totales ponderados por clase x sexo\ntabla_total <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%\n  group_by(wrightclass1_reduced, sexo) %>%\n  summarise(n = survey_total(vartype = NULL)) %>%\n  ungroup() %>%\n  # (opcional) asegurar combinaciones faltantes con 0\n  complete(wrightclass1_reduced, sexo, fill = list(n = 0)) %>%\n  group_by(sexo) %>%\n  mutate(prop = n / sum(n)) %>%      # proporción dentro de cada sexo\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico: barras agrupadas (dodge), normalizadas dentro de cada sexo\nggplot(tabla_total, aes(x = wrightclass1_reduced, y = prop, fill = sexo)) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  scale_fill_manual(values = c(\"Mujer\" = \"#f25f5c\", \"Hombre\" = \"#9e1b1e\")) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    position = position_dodge(width = 0.8),\n    vjust = -0.3,\n    size = 2.8\n  ) +\n  labs(\n    title = \"Distribución por clase social dentro de cada sexo\",\n    x = \"Clase social\",\n    y = \"Porcentaje\",\n    fill = \"Sexo\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw)\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/class1_sexo.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### sexo x clase\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular proporciones ponderadas por clase social y sexo\ntabla_total <- data_svy %>%\n  filter(\n    !is.na(wrightclass1_reduced),\n    !is.na(sexo)\n  ) %>% \n  group_by(wrightclass1_reduced, sexo) %>%\n  summarise(prop = survey_mean(vartype = NULL, proportion = TRUE)) %>%\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico\nggplot(tabla_total, aes(x = wrightclass1_reduced, y = prop, fill = sexo)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_manual(values = c(\"Mujer\" = \"#f25f5c\", \"Hombre\" = \"#9e1b1e\")) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = round(prop * 100, 1)),\n    position = position_dodge(width = 0.8),\n    vjust = 1.3,\n    color = \"white\",\n    size = 3\n  ) +\n  labs(\n    title = \"Porcentaje de hombres y mujeres en cada categoría de clase social\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw),\n    x = \"Clase social\",\n    y = \"Porcentaje\",\n    fill = \"Sexo\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/class1_sexo_by_class.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### sexo x clase 2\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Totales ponderados por clase x sexo y proporciones dentro de cada clase\ntabla_total <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%\n  group_by(wrightclass1_reduced, sexo) %>%\n  summarise(n = survey_total(vartype = NULL)) %>%   # totales ponderados\n  group_by(wrightclass1_reduced) %>%\n  mutate(prop = n / sum(n)) %>%                     # % dentro de cada clase\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Gráfico apilado (cada barra suma 100%)\nggplot(tabla_total, aes(x = wrightclass1_reduced, y = prop, fill = sexo)) +\n  geom_col(position = \"stack\") +\n  scale_fill_manual(values = c(\"Mujer\" = \"#f25f5c\", \"Hombre\" = \"#9e1b1e\")) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    position = position_stack(vjust = 0.5),\n    color = \"white\",\n    size = 2.8\n  ) +\n  labs(\n    title = \"Composición por sexo dentro de cada clase social\",\n    caption = paste0(\"Fuente: Elaboración propia con datos de la Encuesta Conclat Chile 2024. Datos ponderados. N = \", n_unw),\n    x = \"Clase social\",\n    y = \"Porcentaje dentro de la clase\",\n    fill = \"Sexo\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/class1_sexo_by_class_2.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### clase x sexo x edad\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular proporciones por sexo y edad\nclass1_sexo_edad <- data_svy %>%\n  filter(\n    !is.na(sexo),\n    !is.na(edad_tramos),\n    !is.na(wrightclass1_reduced)\n  ) %>%\n  group_by(edad_tramos, sexo, wrightclass1_reduced) %>%\n  summarise(prop = survey_mean(na.rm = TRUE)) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: There was 1 warning in `dplyr::summarise()`.\nℹ In argument: `prop = survey_mean(na.rm = TRUE)`.\nℹ In group 1: `edad_tramos = 18-24`, `sexo = Hombre`, `wrightclass1_reduced =\n  1. Formal workers`.\nCaused by warning:\n! na.rm argument has no effect on survey_mean when calculating grouped proportions. \nThis warning is displayed once per session.\n```\n\n\n:::\n\n```{.r .cell-code}\nn_unw <- data_svy %>%\n  filter(!is.na(wrightclass1_reduced), !is.na(sexo), !is.na(edad_tramos)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Graficar\ngrafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +\n  geom_col(position = \"fill\", color = \"white\") +\n  geom_text(\n    aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), \"%\"), \"\")),  # mostrar solo si es >4%\n    position = position_fill(vjust = 0.5),\n    color = \"white\",\n    size = 3.5\n  ) +\n  facet_wrap(~sexo) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  scale_fill_manual(\n    values = c(\n      \"1. Formal workers\" = \"#6f0000\",\n      \"2. Informal workers\" = \"#9e1b1e\",\n      \"3. Informal self-employed\" = \"#ca0000\",\n      \"4. Experts\" = \"#ff5651\",\n      \"5. Supervisors\" =\"#b23a48\",\n      \"6. Managers\" = \"#8c1d40\",\n      \"7. Petty bourgeoisie\" = \"#d1eaf3\",\n      \"8. Small employers\" = \"#0f6481\",\n      \"9. Employers\" = \"#083342\"\n  )) +\n  labs(\n    title = \"Clases\",\n    subtitle = \"Porcentajes según sexo y tramo etario\",\n    x = \"Tramo de edad\",\n    y = \"Porcentaje\",\n    fill = \"Clases\",\n    caption = paste0(\"Nota: Datos ponderados. N = \", n_unw)\n  ) +\n  theme_minimal()\n\ngrafico\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph2/class1_sexo_edad.png\", plot = grafico, width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### c05_02 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_02_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Una de las principales razones de la alta desigualdad en Chile \\nes que los dueños de las empresas pagan poco a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c05_03 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_03_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: El alto nivel de vida de los dueños de las empresas es resultado \\nde lo poco que pagan a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c06_02 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c06_02_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Apoyaría una reforma para crear un sistema solidario de reparto \\nsi eso permite subir las pensiones\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_01 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_01_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Aumentar los impuestos a los más ricos para financiar \\nprogramas sociales\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_03 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_03_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Implementar leyes para que los sindicatos tengan más poder \\nde negociación\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_04 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_04_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Redistribuir las riquezas desde quienes tienen más recursos \\nhacia quienes tienen menos recursos\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_05 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_05_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Promover la igualdad entre hombres y mujeres\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_06 x clase x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_06_acuerdo,\n  x_var = wrightclass1_reduced,\n  fill_var = sexo,\n  title = \"Acuerdo con: Garantizar la educación universitaria pública y gratuita\",\n  subtitle = \"Porcentaje según sexo y clase social\",\n  x_label = \"Clase social\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 45\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Politización y sexo\n\n### polit x sexo x edad\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npolitizacion <- data_svy %>%\n  filter(!is.na(politizado),\n         !is.na(sexo),\n         !is.na(edad_tramos)) %>%\n  group_by(edad_tramos, sexo) %>%\n  summarise(prop = survey_mean(politizado,na.rm = TRUE)) %>%\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(!is.na(politizado), !is.na(sexo), !is.na(edad_tramos)) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\nggplot(politizacion, aes(x = edad_tramos, y = prop, fill = sexo)) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  geom_text(\n    aes(label = paste0(round(prop * 100, 1), \"%\")),\n    position = position_dodge(width = 0.8),\n    vjust = -0.5,\n    color = \"black\",\n    size = 4\n  ) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 1)) +\n  scale_fill_manual(values = c(\"Mujer\" = \"#f25f5c\", \"Hombre\" = \"#9e1b1e\")) +\n  labs(\n    title = \"Porcentaje de personas politizadas\",\n    subtitle = \"Según sexo y tramo etario\",\n    x = \"Tramo de edad\",\n    y = \"Porcentaje de personas politizadas\",\n    fill = \"Sexo\",\n    caption = paste0(\"Nota: Datos ponderados. Politización definida como hablar de política (4–5) y confiar en partidos (3–5). N = \", n_unw)) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/politizacion_sexo_edad.png\", width = 10, height = 6, dpi = 300)\n```\n:::\n\n\n\n\n\n\n### c05_02 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_02_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Una de las principales razones de la alta desigualdad en Chile \\nes que los dueños de las empresas pagan poco a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c05_03 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c05_03_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: El alto nivel de vida de los dueños de las empresas es resultado \\nde lo poco que pagan a sus trabajadores\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c06_02 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c06_02_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Apoyaría una reforma para crear un sistema solidario de reparto \\nsi eso permite subir las pensiones\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_01 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_01_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Aumentar los impuestos a los más ricos para financiar \\nprogramas sociales\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_03 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_03_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Implementar leyes para que los sindicatos tengan más poder \\nde negociación\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_04 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_04_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Redistribuir las riquezas desde quienes tienen más recursos \\nhacia quienes tienen menos recursos\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_05 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_05_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Promover la igualdad entre hombres y mujeres\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### c07_06 x polit x sexo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_binary_by(\n  data = data_svy,\n  var = c07_06_acuerdo,\n  x_var = politizado,\n  fill_var = sexo,\n  title = \"Acuerdo con: Garantizar la educación universitaria pública y gratuita\",\n  subtitle = \"Porcentaje según sexo y estatus de politización\",\n  x_label = \"Politizado\",\n  fill_label = \"Sexo\",\n  palette = c(\"Mujer\"=\"#f25f5c\",\"Hombre\"=\"#9e1b1e\"),\n  x_text_angle = 0\n)\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n### pol_id x sexo x edad\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular proporciones por sexo y edad\npol_id_sexo_edad <- data_svy %>%\n  filter(\n    !is.na(sexo),\n    !is.na(edad_tramos),\n    !is.na(pol_id)\n  ) %>%\n  group_by(edad_tramos, sexo, pol_id) %>%\n  summarise(prop = survey_mean(na.rm = TRUE)) %>%\n  ungroup()\n\nn_unw <- data_svy %>%\n  filter(\n    !is.na(sexo),\n    !is.na(edad_tramos),\n    !is.na(pol_id)\n  ) %>%\n  summarise(N = unweighted(n())) %>%\n  pull(N)\n\n# Graficar\ngrafico <- ggplot(pol_id_sexo_edad, aes(x = edad_tramos, y = prop, fill = pol_id)) +\n  geom_col(position = \"fill\", color = \"white\") +\n  geom_text(\n    aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), \"%\"), \"\")),  # mostrar solo si es >4%\n    position = position_fill(vjust = 0.5),\n    color = \"white\",\n    size = 3.5\n  ) +\n  facet_wrap(~sexo) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  scale_fill_manual(\n    values = c(\n      \"Izquierda\" = \"#6f0000\",\n      \"Centro\" = \"#9e1b1e\",\n      \"Derecha\" = \"#ca0000\",\n      \"No se identifica\" = \"#ff5651\"\n  )) +\n  labs(\n    title = \"Identificación política\",\n    subtitle = \"Porcentajes según sexo y tramo etario\",\n    x = \"Tramo de edad\",\n    y = \"Porcentaje\",\n    fill = \"Identificación política\",\n    caption = paste0(\"Nota: Datos ponderados. N = \", n_unw)\n  ) +\n  theme_minimal()\n\ngrafico\n```\n\n::: {.cell-output-display}\n![](05-graph-data-conclat_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"output/graph4/pol_id_sexo_edad.png\", plot = grafico, width = 10, height = 6, dpi = 300)\n```\n:::\n",
    "supporting": [
      "05-graph-data-conclat_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}