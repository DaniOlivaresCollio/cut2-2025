color = "black",
size = 4
) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.1))) +
scale_fill_manual(values = c("Mujer" = "#f25f5c", "Hombre" = "#9e1b1e")) +
labs(
title = "Porcentaje de personas politizadas",
subtitle = "Según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje de personas politizadas",
fill = "Sexo",
caption = "Nota: Datos ponderados. Politización definida como hablar de política (4–5) y confiar en partidos (3–5). N = 3048."
) +
theme_minimal()
ggsave("output/politizado_sexo_edad.png", width = 10, height = 6, dpi = 300)
# Cargar data clases
data_clases <- readRDS("input/data/datos-clases.rds")
names(datos_clases)
names(data_clases)
# Unir a tu base data_svy
data_svy <- data_svy %>%
left_join(datos_clases_sel, by = "id")
# Unir a tu base data_svy
data <- data %>%
left_join(datos_clases_sel, by = "id")
# Seleccionar solo clave y variable
datos_clases_sel <- data_clases %>%
select(id, wrightclass1_reduced, wrightclass2_reduced)
# Unir a tu base data_svy
data <- data %>%
left_join(datos_clases_sel, by = "id")
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, pol_id) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = pol_id)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"Izquierda" = "#ff5651",
"Centro" = "#ca0000",
"Derecha" = "#9e1b1e",
"No se identifica" = "#6f0000"
)) +
labs(
title = "Identificación política",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Identificación política",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
table(data$wrightclass1_reduced)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, pol_id) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = pol_id)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employe" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" = "#ff5651",
"6. Managers" = "#ca0000",
"7. Petty bourgeoisie" = "#9e1b1e",
"8. Small employers" = "#6f0000",
"9. Employers" = "#ff5651"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/pol_id_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = pol_id)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employe" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" = "#ff5651",
"6. Managers" = "#ca0000",
"7. Petty bourgeoisie" = "#9e1b1e",
"8. Small employers" = "#6f0000",
"9. Employers" = "#ff5651"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employe" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" = "#ff5651",
"6. Managers" = "#ca0000",
"7. Petty bourgeoisie" = "#9e1b1e",
"8. Small employers" = "#6f0000",
"9. Employers" = "#ff5651"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employe" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" = "#ff5651",
"6. Managers" = "#ca0000",
"7. Petty bourgeoisie" = "#9e1b1e",
"8. Small employers" = "#6f0000",
"9. Employers" = "#ff5651"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employed" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" = "#ff5651",
"6. Managers" = "#ca0000",
"7. Petty bourgeoisie" = "#9e1b1e",
"8. Small employers" = "#6f0000",
"9. Employers" = "#ff5651"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employed" = "#9e1b1e",
"4. Experts" = "#d1eaf3",
"5. Supervisors" = "#0f6481",
"6. Managers" = "#083342",
"7. Petty bourgeoisie" = "#ff5651",
"8. Small employers" = "#9e1b1e",
"9. Employers" = "#6f0000"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#ff5651",
"2. Informal workers" = "#ca0000",
"3. Informal self-employed" = "#9e1b1e",
"4. Experts" = "#6f0000",
"5. Supervisors" ="#b23a48",
"6. Managers" = "#8c1d40",
"7. Petty bourgeoisie" = "#d1eaf3",
"8. Small employers" = "#0f6481",
"9. Employers" = "#083342"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass1_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass1_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass1_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#6f0000",
"2. Informal workers" = "#9e1b1e",
"3. Informal self-employed" = "#ca0000",
"4. Experts" = "#ff5651",
"5. Supervisors" ="#b23a48",
"6. Managers" = "#8c1d40",
"7. Petty bourgeoisie" = "#d1eaf3",
"8. Small employers" = "#0f6481",
"9. Employers" = "#083342"
)) +
labs(
title = "Clases",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class1_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass2_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass2_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass2_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#6f0000",
"2. Informal workers" = "#9e1b1e",
"3. Informal self-employed" = "#ca0000",
"4. Experts" = "#ff5651",
"5. Supervisors" ="#b23a48",
"6. Managers" = "#8c1d40",
"7. Petty bourgeoisie" = "#d1eaf3",
"8. Small employers" = "#0f6481",
"9. Employers" = "#083342"
)) +
labs(
title = "Clases 2",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases 2",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class2_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
# Calcular proporciones por sexo y edad
class1_sexo_edad <- data_svy %>%
filter(
!is.na(sexo),
!is.na(edad_tramos),
!is.na(wrightclass2_reduced)
) %>%
group_by(edad_tramos, sexo, wrightclass2_reduced) %>%
summarise(prop = survey_mean(na.rm = TRUE)) %>%
ungroup()
# Graficar
grafico <- ggplot(class1_sexo_edad, aes(x = edad_tramos, y = prop, fill = wrightclass2_reduced)) +
geom_col(position = "fill", color = "white") +
geom_text(
aes(label = ifelse(prop > 0.04, paste0(round(prop * 100, 1), "%"), "")),  # mostrar solo si es >4%
position = position_fill(vjust = 0.5),
color = "white",
size = 3.5
) +
facet_wrap(~sexo) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_fill_manual(
values = c(
"1. Formal workers" = "#6f0000",
"2. Informal workers" = "#9e1b1e",
"3. Informal self-employed" = "#ca0000",
"4. Experts" = "#ff5651",
"5. Supervisors" ="#b23a48",
"6. Managers" = "#8c1d40",
"7. Petty bourgeoisie" = "#d1eaf3",
"8. Small employers" = "#0f6481",
"9. Capitalists" = "#083342"
)) +
labs(
title = "Clases 2",
subtitle = "Porcentajes según sexo y tramo etario",
x = "Tramo de edad",
y = "Porcentaje",
fill = "Clases 2",
caption = "Nota: Datos ponderados. N = 3048."
) +
theme_minimal()
grafico
ggsave("output/class2_sexo_edad.png", plot = grafico, width = 10, height = 6, dpi = 300)
